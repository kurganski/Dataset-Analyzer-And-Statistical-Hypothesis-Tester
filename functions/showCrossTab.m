function showCrossTab( tbl, chi2, p, labels, datasetsNames)

% if isempty(tbl)
%     return;
% end


% test data
if ~(exist('tbl','var') && exist('chi2','var') && exist('p','var') && exist('labels','var'))
    tbl = ones(5,5,6,4,5,2);
    tbl(:,1,:,2,:,1) = 0.5;
    chi2 = 111;
    p = 0.09;
    datasetsNames = ["name1","name2","name3","name4","name5","name6"];
    labels = {  'Other','sdf','sdf','sdf','вапап','sdfsdfdfsf';...
                'asdf','вавап','выпыва','sdf','вап','sdaa';...
                'sdfcv','вавап','выпыва','651651','рап','';...
                'asdf','sdfcv','выпыва','sdf','sfg','';...
                'asdf','вавап','sdfcv','','прпр','';...
                '','','вапап','','',''};
end


crossTabFigure = figure( 'Units','pixels', 'Position',[50 50 1000 500]);
setFigureInCenter(crossTabFigure);

                    
popupmenu3 = uicontrol(crossTabFigure, ...
                        'Style','popupmenu',...
                        'Units','pixels', ...
                        'Position', [755 375 240 25],...
                        'Value',1 ,...
                        'FontSize',10,...
                        'Callback',@showCrossTable,...
                        'Visible', 'off' ...
                        );

popupmenu4 = uicontrol(crossTabFigure, ...
                        'Style','popupmenu',...
                        'Units','pixels', ...
                        'Position', [755 310 240 25],...
                        'Value',1 ,...
                        'FontSize',10,...
                        'Callback',@showCrossTable,...
                        'Visible', 'off' ...
                        );

popupmenu5 = uicontrol(crossTabFigure, ...
                        'Style','popupmenu',...
                        'Units','pixels', ...
                        'Position', [755 245 240 25],...
                        'Value',1 ,...
                        'FontSize',10,...
                        'Callback',@showCrossTable,...
                        'Visible', 'off' ...
                        );

popupmenu6 = uicontrol(crossTabFigure, ...
                        'Style','popupmenu',...
                        'Units','pixels', ...
                        'Position', [755 180 240 25],...
                        'Value',1 ,...
                        'FontSize',10,...
                        'Callback',@showCrossTable,...
                        'Visible', 'off' ...
                        );
                    
if size(labels,2) > 2
    data = labels(:,3);
    data(strcmp('',data)) = [];
    data = data(~cellfun('isempty',data));
    
    popupmenu3.String = data;
    popupmenu3.Visible = 'On';
    
    uicontrol(crossTabFigure, ...
                'Style','text',...
                'Units','pixels', ...
                'Position', [755 400 240 40],...
                'FontSize',10,...
                'Visible', 'on', ...
                'String', datasetsNames(3) ...
                );
end      

if size(labels,2) > 3
    
    data = labels(:,4);
    data(strcmp('',data)) = [];
    data = data(~cellfun('isempty',data));
    
    popupmenu4.String = data;
    popupmenu4.Visible = 'On';
    
    uicontrol(crossTabFigure, ...
                'Style','text',...
                'Units','pixels', ...
                'Position', [755 335 240 40],...
                'FontSize',10,...
                'Visible', 'on', ...
                'String', datasetsNames(4) ...
                );
    
end

if size(labels,2) > 4
    
    data = labels(:,5);
    data(strcmp('',data)) = [];
    data = data(~cellfun('isempty',data));
    
    popupmenu5.String = data;
    popupmenu5.Visible = 'On';
    
    uicontrol(crossTabFigure, ...
                'Style','text',...
                'Units','pixels', ...
                'Position', [755 270 240 40],...
                'FontSize',10,...
                'Visible', 'on', ...
                'String', datasetsNames(5) ...
                );
    
end

if size(labels,2) > 5
    
    data = labels(:,6);
    data(strcmp('',data)) = [];
    data = data(~cellfun('isempty',data));
    
    popupmenu6.String = data;
    popupmenu6.Visible = 'On';
    
    uicontrol(crossTabFigure, ...
                'Style','text',...
                'Units','pixels', ...
                'Position', [755 205 240 40],...
                'FontSize',10,...
                'Visible', 'on', ...
                'String', datasetsNames(6) ...
                );
    
end

textLabel = uicontrol(crossTabFigure,'Style','text','Units', 'pixels', ...
                                            'Position', [1 5 1000 40],'FontSize',10);
                                        
textLabel.String = "Значение хи-квадрат: " + num2str(chi2) + ...
                    "; Значение вероятности p: " + num2str(p);

titleLabel = uicontrol(crossTabFigure,'Style','text','Units', 'pixels',...
                                        'Position', [1 455 1000 40],'FontSize',12);

titleLabel.String = "Таблица сопряженности выборок '" + datasetsNames(1) + ...
                        "' и '" + datasetsNames(2) + "'";

crossTabTable = uitable(crossTabFigure,'Units', 'pixels', ...
                                        'Position',[1 50 750 400], 'FontSize',10);

crossTabTable.Data = tbl(:,:,1,1,1,1);

crossTabTable.ColumnName = labels(:,2);
crossTabTable.RowName = labels(:,1);

crossTabFigure.UserData = struct(   'crosstable', tbl, ...
                                    'tableHandle', crossTabTable,...    
                                    'popupmenu3', popupmenu3,...
                                    'popupmenu4', popupmenu4,...
                                    'popupmenu5', popupmenu5,...
                                    'popupmenu6', popupmenu6);

end

function showCrossTable(source,event)

userData = get(gcf,'UserData');

userData.tableHandle.Data = userData.crosstable(:,:,...
                                    userData.popupmenu3.Value,...
                                    userData.popupmenu4.Value,...
                                    userData.popupmenu5.Value,...
                                    userData.popupmenu6.Value);

end
